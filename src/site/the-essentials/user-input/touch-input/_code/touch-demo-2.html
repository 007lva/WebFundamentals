<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- IE Specific to remove tap highlight -->
    <meta name="msapplication-tap-highlight" content="no"/>

    <title>Web Essential: Touch Example 2</title>
    
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300' rel='stylesheet' type='text/css'>

    <style>
      .container {
        display: flex;
        display: -ms-flexbox;
        
        width: 100%;
        
        flex-direction: row;
        -ms-flex-direction: row;
        
        align-items: center;
        -ms-flex-align: center;
        
        justify-content: space-around;
        -ms-flex-pack: justify;
      }

      .v-slider {
        position: relative;
        
        width: 46px;
        height: 200px;
        
        margin: 23px 0;
        
        // Pass all touches to javascript
        touch-action: none;
        -ms-touch-action: none;
      }

      .v-slider > .track {
        position: absolute;
        
        width: 6px;
        height: 200px;
        
        left: 50%;
        
        margin-left: -3px;
        
        border-radius: 6px;
        
        background-color: rgba(0,0,0,0.4);
      }

      .v-slider > .hold {
        position: absolute;
        
        width: 46px;
        height: 46px;
        
        border-radius: 100%;
        
        top: 0;
        left: 50%;
        
        margin-top: -23px;
        margin-left: -23px;
        
        background-color: rgb(60,60,60);
      }
    </style>
  </head>

  <body>

    <div class="container">
      <div class="v-slider">
        <div class="track"></div>
        <div class="hold"></div>
      </div>

      <div class="v-slider">
        <div class="track"></div>
        <div class="hold"></div>
      </div>
    </div>

    <script>
      // Shim for requestAnimationFrame from Paul Irishpaul ir
      // http://www.paulirish.com/2011/requestanimationframe-for-smart-animating/ 
      window.requestAnimFrame = (function(){
        return  window.requestAnimationFrame       ||
                window.webkitRequestAnimationFrame ||
                window.mozRequestAnimationFrame    ||
                function( callback ){
                  window.setTimeout(callback, 1000 / 60);
                };
      })();

      function Slider(element) {
        var isAnimating = false;
        var lastYPos = 0;
        var initialSliderPos = 0;
        var lastHolderPos = 0; 
        var elementHold = element.querySelector('.hold');
        
      this.handleGestureStart = function(evt) {
        evt.preventDefault();

        var point = getGesturePointFromEvent(evt);
        initialSliderPos = point.y;

          // Add Mouse Listeners
          document.addEventListener('mousemove', this.handleGestureMove, true);
          document.addEventListener('mouseup', this.handleGestureEnd, true);
      }.bind(this);

      this.handleGestureEnd = function(evt) {
        evt.preventDefault();
          
          if(evt.targetTouches && evt.targetTouches.length > 0) {
            return;
          }
        
        isAnimating = false;
        
        lastHolderPos = lastHolderPos + -(initialSliderPos - lastYPos);
          
          // Remove Mouse Listeners
          document.removeEventListener('mousemove', this.handleGestureMove, true);
          document.removeEventListener('mouseup', this.handleGestureEnd, true);
      }.bind(this);

      this.handleGestureMove = function(evt) {
        evt.preventDefault();
        
        var point = getGesturePointFromEvent(evt);

        lastYPos = point.y;
        
          if(isAnimating) {
            return;
          }
          
          isAnimating = true;
          
          window.requestAnimFrame(onAnimFrame);
      }.bind(this);

      function getGesturePointFromEvent(evt) {
          var point = {
            x: evt.screenX,
            y: evt.screenY
          };
          
          // Prefer touch events if we have them.
          if (window.navigator.msPointerEnabled) {
            point.x = evt.clientX;
            point.y = evt.clientY;
          } else if (evt.targetTouches && evt.targetTouches.length > 0) {
            point.x = evt.targetTouches[0].clientX;
            point.y = evt.targetTouches[0].clientY;
          }
          
          return point;
      }

      function onAnimFrame() {
          if(!isAnimating) {
            return;
          }
          
          var differenceInY = lastHolderPos + -(initialSliderPos - lastYPos);
        
          if(Math.abs(differenceInY) > element.clientHeight) {
            differenceInY = element.clientHeight;
          } else if(differenceInY < 0) {
            differenceInY = 0;
          }
        
          var newYTransform = (differenceInY)+'px';
          var transformStyle = 'translateY('+newYTransform+')';
          elementHold.style['-webkit-transform'] = transformStyle;
          elementHold.style['-moz-transform'] = transformStyle;
          elementHold.style.transform = transformStyle;
          
          isAnimating = false;
        }

        if (window.navigator.msPointerEnabled) {
          // Pointer events are supported.
          elementHold.addEventListener('MSPointerDown', this.handleGestureStart, true);
          elementHold.addEventListener('MSPointerMove', this.handleGestureMove, true);
          elementHold.addEventListener('MSPointerUp', this.handleGestureEnd, true);
        } else {
          elementHold.addEventListener('mousedown', this.handleGestureStart, true);

          // Add Touch Listeners
          elementHold.addEventListener('touchstart', this.handleGestureStart, true);
          elementHold.addEventListener('touchmove', this.handleGestureMove, true);
          elementHold.addEventListener('touchend', this.handleGestureEnd, true);
          elementHold.addEventListener('touchcancel', this.handleGestureEnd, true);
        }
      }

      window.onload = function () {
        var sliderElements = document.querySelectorAll('.v-slider');
        for(var i = 0; i < sliderElements.length; i++) {
          new Slider(sliderElements[i]);
        }
      };
    </script>
  </body>
</html>